# Creating the self-published tls certificate
openssl req -x509 -newkey rsa:4096 -keyout server.key -out server.crt -days 365 -nodes

# Troubleshoot bankend connnection
Will produce output if the server is running
```
lsof -i :8080 
```

Will return html if FastAPI is running
```
curl -k https://localhost:8080/docs
```

# Build and run docker
```
docker build -t flare-ai-defai . && docker run -p 80:80 -p 8080:8080 -it --env-file .env flare-ai-defai
```

# uv
```
uv add package1 package2
```

# Colour scheme
Midnight Blue (#1A2A44) – Trustworthy base
Electric Cyan (#00D4FF) – Modern crypto accent
Soft Gray (#E8ECEF) – Clean neutral
Success Green (#34C759) – Positive feedback
Warm Orange (#FF9500) – Alerts









DEBUG:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "event": "Entered verify function.", "level": "debug", "logger": "flare_ai_defai.api.routes.chat", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:30.957433Z"}
DEBUG:google.auth.transport.requests:Making request: GET https://www.googleapis.com/oauth2/v1/certs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): www.googleapis.com:443
DEBUG:urllib3.connectionpool:https://www.googleapis.com:443 "GET /oauth2/v1/certs HTTP/1.1" 200 2361
INFO:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "email": "simonjonsson87@gmail.com", "event": "User authenticated", "level": "info", "logger": "flare_ai_defai.api.routes.chat", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:30.972857Z", "user_id": "105823169284787252195"}
INFO:     145.40.158.189:0 - "POST /api/routes/chat/verify HTTP/1.1" 200 OK
DEBUG:google.auth.transport.requests:Making request: GET https://www.googleapis.com/oauth2/v1/certs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): www.googleapis.com:443
DEBUG:urllib3.connectionpool:https://www.googleapis.com:443 "GET /oauth2/v1/certs HTTP/1.1" 200 2361
DEBUG:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "event": "In chat function - Received message", "level": "debug", "logger": "flare_ai_defai.api.routes.chat", "message": "swap 1 flr for usdc", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:42.315405Z", "user_id": "105823169284787252195"}
DEBUG:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "level": "debug", "logger": "flare_ai_defai.api.routes.chat", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:42.315545Z", "tx_queue": [], "tx_queue_len": 0}
DEBUG:flare_ai_defai.ai.gemini:{"blockchain": "explorer", "event": "generate", "level": "debug", "logger": "flare_ai_defai.ai.gemini", "prompt": "\nClassify the following user input into EXACTLY ONE category. Analyze carefully and choose the most specific matching category.\n\nCategories (in order of precedence):\n1. GENERATE_ACCOUNT\n   \u2022 Keywords: create wallet, new account, generate address, make wallet\n   \u2022 Must express intent to create/generate new account/wallet\n   \u2022 Ignore if just asking about existing accounts\n\n2. SEND_TOKEN\n   \u2022 Keywords: send, transfer, pay, give tokens\n   \u2022 Must include intent to transfer tokens to another address\n   \u2022 Should involve one-way token movement\n\n3. SWAP_TOKEN\n   \u2022 Keywords: swap, exchange, trade, convert tokens\n   \u2022 Must involve exchanging one token type for another\n   \u2022 Should mention both source and target tokens\n\n4. REQUEST_ATTESTATION\n   \u2022 Keywords: attestation, verify, prove, check enclave\n   \u2022 Must specifically request verification or attestation\n   \u2022 Related to security or trust verification\n\n5. CONVERSATIONAL (default)\n   \u2022 Use when input doesn't clearly match above categories\n   \u2022 General questions, greetings, or unclear requests\n   \u2022 Any ambiguous or multi-category inputs\n   \n6. STAKE_STAKE\n   - Keywords: stake, staking, lock, earn rewards, deposit for staking\n   - Must express intent to stake or lock tokens to earn rewards or participate in a staking mechanism.\n   - Typically involves committing tokens to a protocol or smart contract for a period.\n   - Ignore if the user is just asking about staking without intent to perform the action.\n   Examples:\n   \"I want to stake 10 FLR.\"\n   \"Can you help me lock my tokens for staking?\"\n   \"Stake my tokens to earn rewards.\"\n   \n7. SUPPLY_TOKEN\n   - Keywords: supply, lend, provide, deposit for lending\n   - Must indicate intent to supply or lend tokens to a protocol (e.g., a lending pool or liquidity pool).\n   - Involves depositing tokens to enable others to borrow or use them, often for interest.\n   - Ignore if the user is just inquiring about supplying without intent to act.\n   Examples:\n   \"Supply 5 FLR to the lending pool.\"\n   \"I want to lend my tokens.\"\n   \"Deposit 20 tokens for others to borrow.\"   \n   \n8. BORROW_TOKEN\n   - Keywords: borrow, loan, take out, get a loan\n   - Must express intent to borrow tokens from a protocol or pool, typically requiring collateral or a repayment plan.\n   - Involves requesting tokens with an obligation to return them later (possibly with interest).\n   - Ignore if the user is just asking about borrowing without intent to proceed.\n   Examples:\n   \"Borrow 3 FLR from the pool.\"\n   \"Can I take out a loan of 10 tokens?\"\n   \"Get me a loan in FLR.\"   \n\nInput: swap 1 flr for usdc\n\nInstructions:\n- Choose ONE category only\n- Select most specific matching category\n- Default to CONVERSATIONAL if unclear\n- Ignore politeness phrases or extra context\n- Focus on core intent of request\n", "response_text": "SwapToken", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:42.779290Z"}
DEBUG:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "event": "In handle_swap_token()", "level": "debug", "logger": "flare_ai_defai.api.routes.chat", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:42.779578Z"}
DEBUG:flare_ai_defai.ai.gemini:{"blockchain": "explorer", "event": "generate", "level": "debug", "logger": "flare_ai_defai.ai.gemini", "prompt": "\n    You are an assistant that extracts specific information for a token swap operation from the user input. Your task is to extract EXACTLY the following three fields:\n\n    1. \"from_token\":  \n    - This is the source token that the user wants to swap from.\n    - Output must be in uppercase.  \n    - If the token is not recognized, output null.\n\n    2. \"to_token\":  \n    - This is the destination token that the user wants to receive.\n    - Output must be in uppercase.\n    - If the token is not recognized or if it is the same as the source token, output null.\n\n    3. \"amount\":  \n    - This is the numeric value the user wants to swap.\n    - Extract the FIRST standalone number (integer or decimal) from the input.\n    - Convert the number to a float.\n    - If no valid number is found or the number is not positive, output null.\n\n    Valid tokens are FLR, USDC, USDT, WFLR, SFLR, WETH, JOULE (case-insensitive). Some tokens have nicknames. Here is a list:\n    - FLR tokens are sometimes called Flare tokens\n    - sFLR tokens are sometimes called staked Flare tokens\n    - WFLR tokens are sometimes called wrapped Flare tokens\n    - WETH is sometimes called wrapped eth, or wrapped ether\n    - USDT is sometimes called tether.\n\n    Your output must be a valid JSON object with exactly these three keys: \"from_token\", \"to_token\", and \"amount\". Do not include any additional text, commentary, or formatting. If any of the three pieces of information are missing or invalid, output a JSON object with those keys set to null.\n\n    Examples:\n    - For the input: \"I want to swap 20 WFLR to USDC\"  \n    Output: {\"from_token\": \"WFLR\", \"to_token\": \"USDC\", \"amount\": 20.0}\n\n    - For the input: \"swap 50 usdt to flr\"  \n    Output: {\"from_token\": \"USDT\", \"to_token\": \"FLR\", \"amount\": 50.0}\n\n    - For the input: \"exchange 10.5 sflr for weth\"  \n    Output: {\"from_token\": \"SFLR\", \"to_token\": \"WETH\", \"amount\": 10.5}\n\n    - For the input: \"trade 5 weth to usdc\"  \n    Output: {\"from_token\": \"WETH\", \"to_token\": \"USDC\", \"amount\": 5.0}\n\n    Instructions:\n    1. Read the user input provided below (inserted where swap 1 flr for usdc appears).\n    2. Extract the required three pieces of information.\n    3. Output only a valid JSON object that includes exactly the keys \"from_token\", \"to_token\", and \"amount\".\n    4. Do not output any additional text, explanation, or formatting.\n\n    Input: swap 1 flr for usdc\n", "response_text": "{\"from_token\": \"FLR\", \"to_token\": \"USDC\", \"amount\": 1.0}", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:43.226772Z"}
DEBUG:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "event": "In getDeFiJson. ", "json": {"amount": 1.0, "from_token": "FLR", "to_token": "USDC"}, "json_len": 3, "level": "debug", "logger": "flare_ai_defai.api.routes.chat", "message": "swap 1 flr for usdc", "prompt": "\n    You are an assistant that extracts specific information for a token swap operation from the user input. Your task is to extract EXACTLY the following three fields:\n\n    1. \"from_token\":  \n    - This is the source token that the user wants to swap from.\n    - Output must be in uppercase.  \n    - If the token is not recognized, output null.\n\n    2. \"to_token\":  \n    - This is the destination token that the user wants to receive.\n    - Output must be in uppercase.\n    - If the token is not recognized or if it is the same as the source token, output null.\n\n    3. \"amount\":  \n    - This is the numeric value the user wants to swap.\n    - Extract the FIRST standalone number (integer or decimal) from the input.\n    - Convert the number to a float.\n    - If no valid number is found or the number is not positive, output null.\n\n    Valid tokens are FLR, USDC, USDT, WFLR, SFLR, WETH, JOULE (case-insensitive). Some tokens have nicknames. Here is a list:\n    - FLR tokens are sometimes called Flare tokens\n    - sFLR tokens are sometimes called staked Flare tokens\n    - WFLR tokens are sometimes called wrapped Flare tokens\n    - WETH is sometimes called wrapped eth, or wrapped ether\n    - USDT is sometimes called tether.\n\n    Your output must be a valid JSON object with exactly these three keys: \"from_token\", \"to_token\", and \"amount\". Do not include any additional text, commentary, or formatting. If any of the three pieces of information are missing or invalid, output a JSON object with those keys set to null.\n\n    Examples:\n    - For the input: \"I want to swap 20 WFLR to USDC\"  \n    Output: {\"from_token\": \"WFLR\", \"to_token\": \"USDC\", \"amount\": 20.0}\n\n    - For the input: \"swap 50 usdt to flr\"  \n    Output: {\"from_token\": \"USDT\", \"to_token\": \"FLR\", \"amount\": 50.0}\n\n    - For the input: \"exchange 10.5 sflr for weth\"  \n    Output: {\"from_token\": \"SFLR\", \"to_token\": \"WETH\", \"amount\": 10.5}\n\n    - For the input: \"trade 5 weth to usdc\"  \n    Output: {\"from_token\": \"WETH\", \"to_token\": \"USDC\", \"amount\": 5.0}\n\n    Instructions:\n    1. Read the user input provided below (inserted where swap 1 flr for usdc appears).\n    2. Extract the required three pieces of information.\n    3. Output only a valid JSON object that includes exactly the keys \"from_token\", \"to_token\", and \"amount\".\n    4. Do not output any additional text, explanation, or formatting.\n\n    Input: swap 1 flr for usdc\n", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:43.227062Z"}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_getTransactionCount
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getTransactionCount
DEBUG:web3._utils.http_session_manager.HTTPSessionManager:Session cached: https://flare-api.flare.network/ext/C/rpc, <requests.sessions.Session object at 0x7db3ed656090>
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): flare-api.flare.network:443
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getTransactionCount, Response: {'jsonrpc': '2.0', 'id': 0, 'result': '0x4b'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_getBlockByNumber
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 None
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber, Response: {'jsonrpc': '2.0', 'id': 1, 'result': {'baseFeePerGas': '0x5d21dba00', 'blockExtraData': '0x', 'blockGasCost': '0x61a80', 'difficulty': '0x1', 'extDataGasUsed': '0x0', 'extDataHash': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421', 'extraData': '0x0000000000000000000000000000000000000000000c18070000000000000000000000000007da6600000000000000000000000000000000000000000007cfc8000000000008b8ce0000000000000000', 'gasLimit': '0x7a1200', 'gasUsed': '0x112834', 'hash': '0x09c8e871eeeb80e479d103afbc32d1b13f3e66798faf2aa837f900781a09afdf', 'logsBloom': '0x00020000000040004000000000000000000000000000000000000004000000000000000000000000000000084000000000000000000000000000000820000000000000000000000000400000000000000000000000000000000080000000000000000000000400000000000001000000000000000040000001001000000000000000000000000000000000000000000000400000008010000004000400000000080000000000000008000000200000000000000000000000000000000280000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000080000000000000000000000000000000000000000', 'miner': '0x0100000000000000000000000000000000000000', 'mixHash': '0x0000000000000000000000000000000000000000000000000000000000000000', 'nonce': '0x0000000000000000', 'number': '0x24ea374', 'parentHash': '0x9150f5cea11d1665cd06d94f60121c3b44903d64446efcfc0e8ab00122442d37', 'receiptsRoot': '0x1f920ebb6908122b75ac368681a817e8f7caf9c628b164a1e7005dd7a69d31bf', 'sha3Uncles': '0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347', 'size': '0x250a', 'stateRoot': '0xa994e28eb6a754d7488c0b4256a3c7f5b0cab4776803b0e2f7b4b31a95d591ec', 'timestamp': '0x67d3833d', 'totalDifficulty': '0x24ea374', 'transactions': ['0x83c553958df684b375acb3b95313afafeb825909da70ce2c055d2c384c5c96b8', '0x0c41522e304e692281b1c71164e5c8ccaaf37d07427e1a6b65f7b15759c5c78d', '0xa6c501557c3654e22d035adaf3aaeb47b51b403511e2c54298eedbb3076862fb', '0x82ffcbd0510ed98621c936e3ed5adf5d767f86d9ff2b0853c90bb519b4340894', '0x5668815a5d03f6c16ffb07098b578052f125df9edcdc30b5b362ac1900ca746d', '0x3babf7affcca6890888fc38a68118c8dfa44dfc83680a5f710ebe748c0522c5e', '0x9b37e81263879d4d24fc633c65cf048954580d801777e956c2fb007fb84fd0c3', '0xb68f61a2f5ac589a5faa40bec444a0d570cdc929a458253b82571f8ecf470d90'], 'transactionsRoot': '0x66c3f95e5737fe09abf8d4b745a6374ccfcb95b4aa6bac384449797e874ad3e5', 'uncles': []}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_maxPriorityFeePerGas
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_maxPriorityFeePerGas
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 40
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_maxPriorityFeePerGas, Response: {'jsonrpc': '2.0', 'id': 2, 'result': '0x0'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 40
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 3, 'result': '0xe'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_estimateGas
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 40
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 4, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_estimateGas
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 44
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_estimateGas, Response: {'jsonrpc': '2.0', 'id': 5, 'result': '0x292b4'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 40
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 6, 'result': '0xe'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_getBlockByNumber
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 None
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber, Response: {'jsonrpc': '2.0', 'id': 7, 'result': {'baseFeePerGas': '0x5d21dba00', 'blockExtraData': '0x', 'blockGasCost': '0x61a80', 'difficulty': '0x1', 'extDataGasUsed': '0x0', 'extDataHash': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421', 'extraData': '0x00000000000c18070000000000000000000000000007da6600000000000000000000000000000000000000000007cfc8000000000008b8ce000000000011283400000000000000000000000000000000', 'gasLimit': '0x7a1200', 'gasUsed': '0xab89d', 'hash': '0x6d739658781c1c0ea2170526044e64c0fd7d51f4d92076b5a69e16db5adb1241', 'logsBloom': '0x00020000000040000000000000000008000000000000000000000004000000000000000000000000000000004000000000000000000000000000400000000000000000000000000000400000000000000000000000000000200080000000000000000000004400000000000000000000000000000040000001000000000000000000000000000000000000000000000000000000000000000004000400000000080000000000000008000000200000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000400000000000000000000020000000', 'miner': '0x0100000000000000000000000000000000000000', 'mixHash': '0x0000000000000000000000000000000000000000000000000000000000000000', 'nonce': '0x0000000000000000', 'number': '0x24ea375', 'parentHash': '0x09c8e871eeeb80e479d103afbc32d1b13f3e66798faf2aa837f900781a09afdf', 'receiptsRoot': '0x686170a67c2675569c58a9ec09ca01718a7f3766ee779f38c84183dda5254d3f', 'sha3Uncles': '0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347', 'size': '0x1cb1', 'stateRoot': '0x79999ed10b5b07743e29cf5594c353f4400230903fc3d367dc662733308b7a4f', 'timestamp': '0x67d3833f', 'totalDifficulty': '0x24ea375', 'transactions': ['0xe1f59f21e418b86dece2d707aea516165e53568df386e9bc07a10b142b53152e', '0x8d159aace87ab417903b0134b60b5d8039dabff02a8c08739aa8356552dd3784', '0x837f49378ff99ed8f881d1aef37b5c0d7216803b7c2f69115fae8c989b57f109', '0x2819b16f0e6e8e466b56a62219b8b7e5802bc5e2911459651af5d12cc8299d8c', '0xda80b7bf1ef5927887a909069e918c4857f5e636d43065ef6876ef98e946dab4'], 'transactionsRoot': '0x743941b077e61fc57e1180f2da52e8567c76c6bcf0ee423e47886ae5b7e5bccd', 'uncles': []}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_maxPriorityFeePerGas
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_maxPriorityFeePerGas
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 40
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_maxPriorityFeePerGas, Response: {'jsonrpc': '2.0', 'id': 8, 'result': '0x0'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_call
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 40
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 9, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 104
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call, Response: {'jsonrpc': '2.0', 'id': 10, 'result': '0x0000000000000000000000000000000000000000000000000000000000000012'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 11, 'result': '0xe'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_call
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 12, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 104
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call, Response: {'jsonrpc': '2.0', 'id': 13, 'result': '0x0000000000000000000000000000000000000000000000000000000000000006'}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 14, 'result': '0xe'}
DEBUG:flare_ai_defai.blockchain.sparkdex:{"blockchain": "explorer", "event": "Token decimals", "extra": {"decimals_in": 18, "decimals_out": 6, "token_in": "wflr", "token_out": "USDC"}, "level": "debug", "logger": "flare_ai_defai.blockchain.sparkdex", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:45.748842Z"}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_getBlockByNumber
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 None
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber, Response: {'jsonrpc': '2.0', 'id': 15, 'result': {'baseFeePerGas': '0x5d21dba00', 'blockExtraData': '0x', 'blockGasCost': '0x61a80', 'difficulty': '0x1', 'extDataGasUsed': '0x0', 'extDataHash': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421', 'extraData': '0x00000000000c18070000000000000000000000000007da6600000000000000000000000000000000000000000007cfc8000000000008b8ce000000000011283400000000000000000000000000000000', 'gasLimit': '0x7a1200', 'gasUsed': '0xab89d', 'hash': '0x6d739658781c1c0ea2170526044e64c0fd7d51f4d92076b5a69e16db5adb1241', 'logsBloom': '0x00020000000040000000000000000008000000000000000000000004000000000000000000000000000000004000000000000000000000000000400000000000000000000000000000400000000000000000000000000000200080000000000000000000004400000000000000000000000000000040000001000000000000000000000000000000000000000000000000000000000000000004000400000000080000000000000008000000200000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000400000000000000000000020000000', 'miner': '0x0100000000000000000000000000000000000000', 'mixHash': '0x0000000000000000000000000000000000000000000000000000000000000000', 'nonce': '0x0000000000000000', 'number': '0x24ea375', 'parentHash': '0x09c8e871eeeb80e479d103afbc32d1b13f3e66798faf2aa837f900781a09afdf', 'receiptsRoot': '0x686170a67c2675569c58a9ec09ca01718a7f3766ee779f38c84183dda5254d3f', 'sha3Uncles': '0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347', 'size': '0x1cb1', 'stateRoot': '0x79999ed10b5b07743e29cf5594c353f4400230903fc3d367dc662733308b7a4f', 'timestamp': '0x67d3833f', 'totalDifficulty': '0x24ea375', 'transactions': ['0xe1f59f21e418b86dece2d707aea516165e53568df386e9bc07a10b142b53152e', '0x8d159aace87ab417903b0134b60b5d8039dabff02a8c08739aa8356552dd3784', '0x837f49378ff99ed8f881d1aef37b5c0d7216803b7c2f69115fae8c989b57f109', '0x2819b16f0e6e8e466b56a62219b8b7e5802bc5e2911459651af5d12cc8299d8c', '0xda80b7bf1ef5927887a909069e918c4857f5e636d43065ef6876ef98e946dab4'], 'transactionsRoot': '0x743941b077e61fc57e1180f2da52e8567c76c6bcf0ee423e47886ae5b7e5bccd', 'uncles': []}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_call
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 16, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 293
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call, Response: {'jsonrpc': '2.0', 'id': 17, 'error': {'code': 3, 'message': 'execution reverted: STF', 'data': '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000'}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 18, 'result': '0xe'}
DEBUG:flare_ai_defai.blockchain.sparkdex:{"blockchain": "explorer", "event": "Fee tier 500 failed: ('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')", "extra": {"params": ["0x1D80c49BbBCd1C0911346656B529DF9E5c2F783d", "0xFbDa5F676cB37624f28265A144A48B0d6e87d3b6", 500, "0x1812C40b5785AeD831EC4a0d675f30c5461Fd42E", 1741915243, 1000000000000000000, 1, 0]}, "level": "debug", "logger": "flare_ai_defai.blockchain.sparkdex", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:46.232285Z"}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_call
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 19, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 293
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call, Response: {'jsonrpc': '2.0', 'id': 20, 'error': {'code': 3, 'message': 'execution reverted: STF', 'data': '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000'}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 21, 'result': '0xe'}
DEBUG:flare_ai_defai.blockchain.sparkdex:{"blockchain": "explorer", "event": "Fee tier 3000 failed: ('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')", "extra": {"params": ["0x1D80c49BbBCd1C0911346656B529DF9E5c2F783d", "0xFbDa5F676cB37624f28265A144A48B0d6e87d3b6", 3000, "0x1812C40b5785AeD831EC4a0d675f30c5461Fd42E", 1741915243, 1000000000000000000, 1, 0]}, "level": "debug", "logger": "flare_ai_defai.blockchain.sparkdex", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:46.581247Z"}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_call
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 22, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 293
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call, Response: {'jsonrpc': '2.0', 'id': 23, 'error': {'code': 3, 'message': 'execution reverted: STF', 'data': '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000'}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 24, 'result': '0xe'}
DEBUG:flare_ai_defai.blockchain.sparkdex:{"blockchain": "explorer", "event": "Fee tier 10000 failed: ('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')", "extra": {"params": ["0x1D80c49BbBCd1C0911346656B529DF9E5c2F783d", "0xFbDa5F676cB37624f28265A144A48B0d6e87d3b6", 10000, "0x1812C40b5785AeD831EC4a0d675f30c5461Fd42E", 1741915243, 1000000000000000000, 1, 0]}, "level": "debug", "logger": "flare_ai_defai.blockchain.sparkdex", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:46.941595Z"}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_getBlockByNumber
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 None
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_getBlockByNumber, Response: {'jsonrpc': '2.0', 'id': 25, 'result': {'baseFeePerGas': '0x5d21dba00', 'blockExtraData': '0x', 'blockGasCost': '0x61a80', 'difficulty': '0x1', 'extDataGasUsed': '0x0', 'extDataHash': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421', 'extraData': '0x00000000000c18070000000000000000000000000007da6600000000000000000000000000000000000000000007cfc8000000000008b8ce000000000011283400000000000000000000000000000000', 'gasLimit': '0x7a1200', 'gasUsed': '0xab89d', 'hash': '0x6d739658781c1c0ea2170526044e64c0fd7d51f4d92076b5a69e16db5adb1241', 'logsBloom': '0x00020000000040000000000000000008000000000000000000000004000000000000000000000000000000004000000000000000000000000000400000000000000000000000000000400000000000000000000000000000200080000000000000000000004400000000000000000000000000000040000001000000000000000000000000000000000000000000000000000000000000000004000400000000080000000000000008000000200000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000400000000000000000000020000000', 'miner': '0x0100000000000000000000000000000000000000', 'mixHash': '0x0000000000000000000000000000000000000000000000000000000000000000', 'nonce': '0x0000000000000000', 'number': '0x24ea375', 'parentHash': '0x09c8e871eeeb80e479d103afbc32d1b13f3e66798faf2aa837f900781a09afdf', 'receiptsRoot': '0x686170a67c2675569c58a9ec09ca01718a7f3766ee779f38c84183dda5254d3f', 'sha3Uncles': '0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347', 'size': '0x1cb1', 'stateRoot': '0x79999ed10b5b07743e29cf5594c353f4400230903fc3d367dc662733308b7a4f', 'timestamp': '0x67d3833f', 'totalDifficulty': '0x24ea375', 'transactions': ['0xe1f59f21e418b86dece2d707aea516165e53568df386e9bc07a10b142b53152e', '0x8d159aace87ab417903b0134b60b5d8039dabff02a8c08739aa8356552dd3784', '0x837f49378ff99ed8f881d1aef37b5c0d7216803b7c2f69115fae8c989b57f109', '0x2819b16f0e6e8e466b56a62219b8b7e5802bc5e2911459651af5d12cc8299d8c', '0xda80b7bf1ef5927887a909069e918c4857f5e636d43065ef6876ef98e946dab4'], 'transactionsRoot': '0x743941b077e61fc57e1180f2da52e8567c76c6bcf0ee423e47886ae5b7e5bccd', 'uncles': []}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_call
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 26, 'result': '0xe'}
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 293
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_call, Response: {'jsonrpc': '2.0', 'id': 27, 'error': {'code': 3, 'message': 'execution reverted: STF', 'data': '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000'}}
DEBUG:web3.manager.RequestManager:Making request. Method: eth_chainId
DEBUG:web3.providers.HTTPProvider:Making request HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId
DEBUG:urllib3.connectionpool:https://flare-api.flare.network:443 "POST /ext/C/rpc HTTP/1.1" 200 41
DEBUG:web3.providers.HTTPProvider:Getting response HTTP. URI: https://flare-api.flare.network/ext/C/rpc, Method: eth_chainId, Response: {'jsonrpc': '2.0', 'id': 28, 'result': '0xe'}
ERROR:flare_ai_defai.blockchain.sparkdex:{"blockchain": "explorer", "event": "Failed to estimate amount out: ('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')", "extra": {"params": ["0x1D80c49BbBCd1C0911346656B529DF9E5c2F783d", "0xFbDa5F676cB37624f28265A144A48B0d6e87d3b6", 10000, "0x1812C40b5785AeD831EC4a0d675f30c5461Fd42E", 1741915243, 1000000000000000000, 1, 0]}, "level": "error", "logger": "flare_ai_defai.blockchain.sparkdex", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:47.424216Z"}
ERROR:flare_ai_defai.api.routes.chat:{"blockchain": "explorer", "error": "('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')", "event": "message_handling_failed", "exception": "Traceback (most recent call last):\n  File \"/app/src/flare_ai_defai/api/routes/chat.py\", line 218, in chat\n    return await self.route_message(route, message.message, user)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/src/flare_ai_defai/api/routes/chat.py\", line 328, in route_message\n    return await handler(message, user)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/src/flare_ai_defai/api/routes/chat.py\", line 481, in handle_swap_token\n    formatted_preview = self.sparkdex.add_swap_txs_to_queue(user, response_json[\"from_token\"], response_json[\"to_token\"], response_json[\"amount\"])\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/src/flare_ai_defai/blockchain/sparkdex.py\", line 742, in add_swap_txs_to_queue\n    approval_tx, swap_tx = self.swap_erc20_tokens_tx(user, \"wflr\", to_token, amount)\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/src/flare_ai_defai/blockchain/sparkdex.py\", line 587, in swap_erc20_tokens_tx\n    amount_out_wei = universal_router.functions.exactInputSingle(params).call()\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/contract/contract.py\", line 291, in call\n    return call_contract_function(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/contract/utils.py\", line 154, in call_contract_function\n    return_data = w3.eth.call(\n                  ^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/eth/eth.py\", line 246, in call\n    return self._durin_call(transaction, block_identifier, state_override)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/eth/eth.py\", line 265, in _durin_call\n    return self._call(transaction, block_identifier, state_override)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/module.py\", line 112, in caller\n    result = w3.manager.request_blocking(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/manager.py\", line 232, in request_blocking\n    return self.formatted_response(\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/manager.py\", line 198, in formatted_response\n    validate_rpc_response_and_raise_if_error(\n  File \"/app/.venv/lib/python3.12/site-packages/web3/_utils/validation.py\", line 397, in validate_rpc_response_and_raise_if_error\n    response = apply_error_formatters(error_formatters, response)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/.venv/lib/python3.12/site-packages/web3/_utils/formatters.py\", line 146, in apply_error_formatters\n    formatted_resp = pipe(response, error_formatters)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"cytoolz/functoolz.pyx\", line 685, in cytoolz.functoolz.pipe\n  File \"cytoolz/functoolz.pyx\", line 660, in cytoolz.functoolz.c_pipe\n  File \"/app/.venv/lib/python3.12/site-packages/web3/_utils/error_formatters_utils.py\", line 165, in raise_contract_logic_error_on_revert\n    raise ContractLogicError(message, data=data)\nweb3.exceptions.ContractLogicError: ('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')", "level": "error", "logger": "flare_ai_defai.api.routes.chat", "router": "chat", "service": "prompt", "timestamp": "2025-03-14T01:15:47.424387Z"}
Traceback (most recent call last):
  File "/app/src/flare_ai_defai/api/routes/chat.py", line 218, in chat
    return await self.route_message(route, message.message, user)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/flare_ai_defai/api/routes/chat.py", line 328, in route_message
    return await handler(message, user)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/flare_ai_defai/api/routes/chat.py", line 481, in handle_swap_token
    formatted_preview = self.sparkdex.add_swap_txs_to_queue(user, response_json["from_token"], response_json["to_token"], response_json["amount"])
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/flare_ai_defai/blockchain/sparkdex.py", line 742, in add_swap_txs_to_queue
    approval_tx, swap_tx = self.swap_erc20_tokens_tx(user, "wflr", to_token, amount)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/flare_ai_defai/blockchain/sparkdex.py", line 587, in swap_erc20_tokens_tx
    amount_out_wei = universal_router.functions.exactInputSingle(params).call()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/contract/contract.py", line 291, in call
    return call_contract_function(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/contract/utils.py", line 154, in call_contract_function
    return_data = w3.eth.call(
                  ^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/eth/eth.py", line 246, in call
    return self._durin_call(transaction, block_identifier, state_override)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/eth/eth.py", line 265, in _durin_call
    return self._call(transaction, block_identifier, state_override)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/module.py", line 112, in caller
    result = w3.manager.request_blocking(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/manager.py", line 232, in request_blocking
    return self.formatted_response(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/manager.py", line 198, in formatted_response
    validate_rpc_response_and_raise_if_error(
  File "/app/.venv/lib/python3.12/site-packages/web3/_utils/validation.py", line 397, in validate_rpc_response_and_raise_if_error
    response = apply_error_formatters(error_formatters, response)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.12/site-packages/web3/_utils/formatters.py", line 146, in apply_error_formatters
    formatted_resp = pipe(response, error_formatters)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "cytoolz/functoolz.pyx", line 685, in cytoolz.functoolz.pipe
  File "cytoolz/functoolz.pyx", line 660, in cytoolz.functoolz.c_pipe
  File "/app/.venv/lib/python3.12/site-packages/web3/_utils/error_formatters_utils.py", line 165, in raise_contract_logic_error_on_revert
    raise ContractLogicError(message, data=data)
web3.exceptions.ContractLogicError: ('execution reverted: STF', '0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000035354460000000000000000000000000000000000000000000000000000000000')
INFO:     145.40.158.189:0 - "POST /api/routes/chat/ HTTP/1.1" 500 Internal Server Error
